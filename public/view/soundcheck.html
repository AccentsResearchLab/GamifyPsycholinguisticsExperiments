<!DOCTYPE HTML>
<html manifest="./cache.appcache">
<head>

<title>Spy or Not</title>
	<meta charset="utf-8">
	<script type="text/javascript" charset="utf-8" src="./../lib/jquery.js"></script>

<link rel="stylesheet" type="text/css" href="./../css/vote.css" />
<link rel="stylesheet" type="text/css" href="./../css/saa.css" />

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30676346-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>



<div id="container">


<div id="header">

<h1>    Spy or Not?</h1>


</div>



<div id="middle" >


<div id="menu" >

  <ul>
    
    <li><a target="top" href="http://about.accentsresearch.com/?page_id=209">About</a></li>
  </ul>


<div id="soundcheckbuttons" class="hidden">
	<p>
		<input class = "large green button" type="button" id="playButton" value="Listen to Instructions" onClick="playGameMission(event)"/>
<p>
		<form method="post" action="main.html">
		<input class = "large blue button" type="submit" value="Let's get started!" />
		</form>
	</div>
</div>

<div id="mission_text">
	<p>Welcome to the spy game! Please select the place where you grew up:</p>


	<div id="choosegamebuttons">
		<button class = "large purple button" type="button" value="0" onClick="setGameLanguage(event)">Russia</button>
		<button class = "large seagreen button" type="button" value="1" onClick="setGameLanguage(event)">Sussex England</button>
		<button class = "large yellow button" type="button" value="2" onClick="setGameLanguage(event)">South Africa</button>

	</div>


	

</div><!-- close text -->
</div><!-- close middle -->

<div id="footer"></div>

<script type="text/javascript" charset="utf-8" src="./../src/SampleLoaderDisk.js"></script>
<script type="text/javascript" charset="utf-8" src="./../src/Util.js"></script>
<script type="text/javascript" charset="utf-8" src="./../src/Mission.js"></script>

<script  src="http://j.maxmind.com/app/geoip.js"></script>
<!--http://stackoverflow.com/questions/391979/get-client-ip-using-just-javascript-->
<script>
	function getip(json){
      window.jsonIP=json; //gets ipaddress
    }
</script>
<script  src="http://jsonip.appspot.com/?callback=getip"></script>

<script>
	
	var actionURL ="https://docs.google.com/spreadsheet/formResponse?pli=1&formkey=dHpES3FFcnVVZFRKX2J3eWFqOXhtQkE6MQ&amp;ifq";

	function post_to_url(path, params, method) {
  		method = method || "post"; // Set method to post by default, if not specified.

	    var form = document.createElement("form");
	    form.setAttribute("method", method);
	    form.setAttribute("action", path);
	    for(var key in params) {
	        if(params.hasOwnProperty(key)) {
	            var hiddenField = document.createElement("input");
	            hiddenField.setAttribute("type", "hidden");
	            hiddenField.setAttribute("name", key);
	            hiddenField.setAttribute("value", params[key]);
	            form.appendChild(hiddenField);
	         }
	    }
	    document.body.appendChild(form);
    	form.submit();
	}

	var submitForm = function(formurl){
		var visitor = {};
		visitor["ipaddress"] = jsonIP.ip;
		visitor["countrycode"] = geoip_country_code();
		visitor["countryname"] = geoip_country_name();
		visitor["city"] = geoip_city();
		visitor["region"] = geoip_region();
		visitor["regionname"] = geoip_region_name();
		visitor["latitude"] = geoip_latitude();
		visitor["longitude"] = geoip_longitude();
		visitor["browseruseragent"] = navigator.userAgent;
		visitor["navigatorlanguage"] = navigator.language;
		visitor["httpheaderslanguage"] = language;
		
		var params = [];
		params["entry.0.single"] = visitor["ipaddress"];
		params["entry.1.single"] = visitor["countrycode"];
		params["entry.2.single"] = visitor["countryname"];
		params["entry.3.single"] = visitor["city"];
		params["entry.4.single"] = visitor["region"];
		params["entry.5.single"] = visitor["regionname"];
		params["entry.6.single"] = visitor["latitude"];
		params["entry.7.single"] = visitor["longitude"];
		params["entry.8.single"] = visitor["browseruseragent"];
		params["entry.9.single"] = visitor["navigatorlanguage"];
		params["entry.10.single"] = visitor["httpheaderslanguage"];
		
		localStorage.setItem("visitor",JSON.stringify(visitor));
  		post_to_url(formurl,params,"post");
	}

	//http://stackoverflow.com/questions/1043339/javascript-for-detecting-browser-language-preference
	var language;
	$.ajax({ 
	    url: "http://ajaxhttpheaders.appspot.com", 
	    dataType: 'jsonp', 
	    success: function(headers) {
	        language = headers['Accept-Language'];
	        submitForm(actionURL);
	    }
	});
	
//Mac os x change system language to British English and got this:
//en-GB,en-US;q=0.8,en;q=0.6

</script>
</body>
</html>
